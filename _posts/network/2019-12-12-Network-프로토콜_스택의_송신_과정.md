---
layout: post
title:  "프로토콜 스택의 데이터 송신과정"
category: Network
tags: [Network]
comments: true
---



## 프로토콜 스택의 데이터 송수신 과정



- IP 주소를 조사했으면 IP 주소의 상대,  여기에서는 액세스 대상 웹 서버에 메시지를 송신하도록 <br>
  OS 내부에 있는 프로토콜 스택에 의뢰한다. 이 행위는 socket 라이브러리에 의해 이루어 진다.



- 송 수신 동작의 이미지를 그림으로 나타내면 아래와 같다.



<img src="/assets/post-img/network/tcp_socket.jpeg">



> 데이터 송수신 과정
>
> - 해당 과정은 모두 OS 내부 프로토콜 스택에서 발생한다



1. 클라이언트에서 소켓을 만든다
2. 서버측의 소켓에 파이프를 연결한다
3. 데이터를 송수신 한다
4. 파이프를 분리하고 소켓을 제거한다



다음 과정을 사진으로 보며 이해해보자.



<img src="/assets/post-img/network/socketLibrary_call_process.jpeg">





> 클라이언트에서 소켓을 만든다

- socket 라이브러리의 socket() 메서드를 호출한다.
- 운영체제 내부 프로토콜 스택은 소켓의 정보를 저장하기 위해 메모리 영역을 할당하고 그곳에 소켓 제어 정보(상대 IP, 소켓 상태 정보 등)를 저장한다.
- 운영체제는 생성된 소켓의 정보의 파일 디스크립터를 사용자 프로그램에게 반환해준다.
  - 디스크립터
    - 프로토콜 스택의 내부에 이는 다수의 소켓 중 어느 것을 가리키는지를 나타내는 번호표와 같은 존재이다.



> 서비측의 소켓에 파이프를 연결한다

- socket 라이브러리의 connect(디스크립터, 서버 IP 주소, 서버 포트 번호)를 호출하여 서버와 소켓을 연결한다.
- 웹은 포트번호 80, 메일은 25이 default



> 메시지를 주고 받는 송∙수신 단계

- socket 라이브러리의 write(디스크립터, 송신 데이터, 송신데이터 길이)를 호출하여 데이터를 송신한다.
- socket 라이브러리의 read(디스크립터, 수신 버퍼 , ...)를 호출하여 데이터를 수신한다.
  - 수신한 응답 메시지를 저장하는 영역을 수신 버퍼라 한다.



> 파이프를 분리하고 소켓을 제거 한다

- 웹 서버가 응답 메시지를 송신 완료했을때 먼저 소켓을 제거한다.

  이 것이 클라이언트측에 전달되고 read()를 호출 했을때 

  클라이언트는 소켓을 제거한다.