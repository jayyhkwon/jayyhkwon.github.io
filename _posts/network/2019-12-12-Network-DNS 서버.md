---
layout: post
title:  "DNS 서버"
category: Network
tags: [Network]
comments: true
---



## DNS 서버



> **DNS 서버의 기본동작**



- DNS 서버가 받는 Request가 포함하는 정보
  

  1. 이름
     - 서버나 메일 배송 목적지와 같은 이름
  2. 클래스
     - DNS의 구조를 고안했을 때 인터넷 이외에도 네트워크에서의 이용까지 검토하여 식별하기 위해<br>
       클래스라는 정보가 존재한다. 그러나 지금은 인터넷 이외의 네트워크는 소멸되었으므로 클래스는<br>
       항상 인터넷을 나타내는 'IN'이라는 값이 된다.
  3. 타입
     - 이름에 어떤 타입의 정보가 지원되는지를 나타낸다.<br>
       예를 들어 **타입이 A이면** 이름에 IP주소가 지원되는 것을 나타내며, <br>
       **MX이면** 이름에 메일 배송 목적지가 지원된다는 것을 나타낸다. <br>
       또한 이 타입에 따라 클라이언트에 회답하는 정보의 내용이 달라진다.

  - 예시

    - www.lab.cyber.co.kr인 서버의 IP 주소를 조사할 때 클라이언트는
      이름 = www.lab.cyber.co.kr<br>
      클래스=IN<br>

      타입=A
      3가지 정보를 DNS 서버에 보낸다.



<img src="/assets/post-img/network/DNS_Server.jpeg">



- DNS 서버의 응답내용
  - request 정보로 찾은 리소스 레코드(사진 참고)의 내용(192.0.2.226)을 반환한다.




> 서브 도메인

- 예를들어, 도메인 opentutorials.org 는 오픈튜토리얼스의 서버를 가리킨다. 만약 오픈튜토리얼스의 내부 구성원들간에 커뮤니케이션을 위해서 게시판을 운영해야 하고, opentutorials.org 와는 다른 서버를 사용해야 한다면, 도메인을 새로 구입해야 할까? 아니다. DNS 서버에 bbs.opentutorials.org에 대한 IP를 등록하면 opentutorials.org와 bbs.opentutorials.org가 가리키는 IP를 서로 다르게 설정해서, 각각의 도메인이 서로 다른 서버를 가리키게 할 수 있다. 이런 것을 **서브 도메인**이라고 부른다.
  

<img src="https://s3.ap-northeast-2.amazonaws.com/opentutorials-user-file/module/288/1018.png">



> **도메인의 계층**

- 인터넷에는 막대한 수의 서버가 있으므로 이것을 전부 1대의 DNS 서버에 등록하는 불가능하다.

  따라서 정보를 분산시켜 다수의 DNS 서버에 등록하고 DNS 서버끼리 연대하여 원하는 정보를 찾아내는 구조로 이뤄져있다.

- DNS 서버에 등록된 정보는 도메인명이라는 계층적 구조를 가진다.

  - www.opentutorials.org 처럼 점으로 계층을 구분한다.
  - 오른쪽에 위치한 것이 상위 계층이다.
  - 각각을 도메인이라 한다. (org 도메인, opentutorials 도메인, www 도메인 ...)
  - 위의 그림에서 www, bbs, file을 **서브 도메인**이라고 부르고, 위의 예제에서는 서버를 식별하기 위해서 사용됐다. 그리고 opentutorials는 서브 도메인인 www, bbs, file를 포괄하는 상위 도메인으로 사용되고 있고, .org는 최상위 도메인으로 opentutorials가 영리를 목적으로 하지 않는 비영리의 단체나 서비스라는 점을 의미한다. 그리고 최상위 도메인의 상위 도메인이 하나 더 있는데, 이것을 **루트 도메인**(root domain)이라고 부른다. 루트 도메인은 모든 도메인의 뿌리이기 때문에 '.org'의 org나 '.com'의 com과 같은 도메인 이름이 없고 그냥 '.'으로 표시된다. 그런 이유로 도메인을 표기할 때 일반적으로 생략한다. 하지만, opentutorials.org. 과 같이 주소를 입력해도 정상적으로 잘 작동한다. 이해를 돕기 위해서 비유하자면 루트 도메인 '.'에는 '.org'라는 디렉토리가 들어 있고, '.org' 안에는 '.opentutorials'라는 디렉토리가 있고 '.opentutorials' 안에는 다시 www, bbs, file이 있는 셈이다. 이 관계를 그림으로 나타내면 아래와 같다. 
    

  <img src="https://s3.ap-northeast-2.amazonaws.com/opentutorials-user-file/module/288/1019.png">



> 최상위 도메인



### 최상위 도메인

- [ 최상위 도메인](http://en.wikipedia.org/wiki/.org)은 도메인을 구분하는 가장 큰 카테고리인데, 도메인을 성격에 따라서 분류한 것이다. 이것은 국제기구인 ICANN에서 관리하기 때문에 도메인을 구입하려면 미리 정해져있는 최상위 도메인 중의 하나를 골라야 한다. 도메인을 고르는 방법은 생활코딩의 [도메인 수업](http://opentutorials.org/course/228/1451)을 참고하자. 아래는 몇가지 대표적인 항목이다. 전체 목록은 [위키백과](http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains)를 참조하자.
  - com
  - net
  - org
  - co.kr
  - ac.kr

  이제 DNS 서버가 어떻게 동작하는지 알아볼 차례다. 전세계에는 수만대의 DNS 서버가 있다. 한대의 DNS 서버가 모든 도메인에 대한 정보를 가지고 있는 것을 어려운 일이다. 그래서 인터넷에서는 도메인 정보를 분산해서 저장하고 있다. 예를들어 lab.opentutorials.org의 IP 주소를 조회한다고 해보자. 이 도메인에서 가장 상위에 있는 도메인은 무엇일까? 루트 도메인이다. 루트 도메인은 전세계에 13개가 존재하고, 이 도메인의 IP는 잘 변경되지 않기 때문에 모든 DNS 서버는 루트 도메인을 알고 있다. 여기가 출발점이 되는 것이다. 아래 그림을 보자.



<img src="https://s3.ap-northeast-2.amazonaws.com/opentutorials-user-file/module/288/1023.png">

클라이언트는 브라우저가 설치된 컴퓨터다. 사용자가 URL을 주소창에 opentutorials.org를 입력하고 엔터를 치면, 

- (1) 브라우저가 설치된 컴퓨터는 opentutorials.org의 IP를 알아내기 위해서 가장 가까운 곳에 위치한 DNS에 opentutorials.org의 IP를 문의 한다. 
- (2)가장 가까운 DNS 서버가 IP를 알고 있다면 즉시 IP 주소를 알려준다.  <br>
  하지만 IP 주소를 모르면 루트 도메인 네임서버에게 문의한다. 
- (3) 루트 네임서버는 도메인의 최상위 도메인이 .org인 것을 보고 .org가 등록된 네임서버의 IP를 전달한다.<br>
  이것은 이런 의미가 된다. "나는 IP 주소를 가지고 있지 않지만, .org 네임서버에게 물어보면 도와줄꺼야"
-  (4) 가장 가까운 DNS는 org 도메인을 관리하는 네임서버에게 문의한다.
-  (5) org 네임서버는 opentutorials의 네임서버 IP 주소를 알려준다. 
- (6) 가장 가까운 DNS 서버는 opentutorials의 네임서버에게 문의하고,
-  (7) www 의 네임서버를 알려준다. 
- (8) 최종적으로 www 네임서버에게 문의 후 
- (9) www.opentutorials.org의 IP 주소를 얻는다. 
- (10) 가장 가까운 DNS 서버는 이 IP 주소를 클라이언트에게 알려준다. <br>
  클라이언트 컴퓨터는 이 IP를 브라우저에게 알려주면 브라우저는 이 IP에 해당하는 컴퓨터에 접속 할 수 있게 된다. 



> 가장 가까운 DNS 서버

- 위의 그림에서 가장 가까운 DNS 서버의 의미는 클라이언트에 기본적으로 등록되어 있는 DNS 서버를 의미한다. 클라이언트는 최소 한개 이상의 DNS 서버가 등록되어 있어야 이 DNS 서버를 이용해서 접속하고자 하는 도메인에 대한 IP를 알아낼 수 있다. 기본 DNS라고도 하는데 이 정보는 인터넷에 연결하면 인터넷 서비스 제공자(KT, SK브로드밴드 등)에 의해서 자동으로 설정된다. 기본 DNS를 직접변경하려면 아래의 자료를 참조한다. 이전 단락에서 언급한 분류법에 의하면 '가장 가까운 DNS'는 cache DNS에 해당된다.



> 캐쉬

- 전세계에 흩어져 있는 네임서버들은 이렇게 협력해서 도메인과 IP를 연결해주고 있는 것이다. 이것은 마치 낮선 곳을 찾아갈 때 그 동네 사람들에게 물어 물어서 목적지를 찾아가는 것과 흡사하지 않은가? 그런데 실제로 네임서버는 이것 보다 조금 더 복잡하게 동작한다. 한번 조회한 IP 주소는 각 단계의 네임서버들에 저장되어 있어서, 다음 요청이 들어올 때 다른 네임서버에 방문할 필요가 없이 저장된 IP 주소를 알려줘서 시간과 네트워크 트래픽 부담을 줄인다. 한번 처리 한 작업을 보존해서 속도와 비용을 절감하는 행위를 캐쉬(cache)라고 한다. 이러한 캐쉬 메커니즘은 브라우저를 비롯해서 클라이언트 각 단계의 DNS 서버가 모두 가지고 있다. 그런 이유로 도메인의 IP 주소가 변경되었는데도 불구하고, IP가 변경되지 않는 경우가 있다. 이런 경우 1~2일 정도 경과된 후에는 자동으로 캐쉬들이 새로 만들어지기 때문에 자동으로 해소된다. 또는 도메인의 소유자가 자신의 도메인의 캐쉬 갱신 주기를 저정 할 수 있다. 



ref. <a href="https://opentutorials.org/module/288/2802">생활코딩</a><br>

ref <a href="https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=163484025">성공과 실패를 결정하는 1% 네트워크 원리</a>

