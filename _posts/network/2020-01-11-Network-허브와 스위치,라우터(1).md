---
layout: post
title:  "허브와 스위치,라우터(1)"
category: Network
tags: [Network]
comments: true
---



##케이블과 리피터, 허브속을 신호가 흘러간다

<br>

> 1. **하나하나의 패킷이 독립된 것으로 동작한다**

-  컴퓨터에서 송신된 패킷은  허브나 라우터라는 중계 장치에 의해 중계되어 목적지를 향해 진행한다. **패킷의 헤더에 기록된 제어정보와 중계 장치의 내부에 있는 중계 대상을 등록한 표로 목적지를 판단하고 목적지에 가까워지도록 하여 패킷을 중계한다는 형태이다.** 중계 과정에서 중계장치는 데이터 부분을 보지않고 패킷을 중계한다.
- 내용을 보지 않으므로 거기에 쓰여있는 애플리케이션의 데이터 TCP 프로토콜의 제어 정보의 내용이 패킷을 운반하는 동작에 영향을 주지 않는다.
- 클라이언트 PC가 송신한 패킷이 리피터 허브 -> 스위칭 허브 -> 라우터 -> 인터넷으로 나가는 것을 가정한다.

<br>

> 2. **LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다**

<img src="/assets/post-img/network/lanStructure.jpeg">

<br>

- LAN 어댑터의 PHY(MAU) 회로에서 전기 신호로 형태를 바꾼 패킷은 RJ-45 커넥터를 통해 **트위스트 페어 케이블**에 들어가는데, 이 부분을 확대한 것이 **아래 그림의 오른쪽**이다. 이더넷 신호의 실체는 플러스와 마이너스의 전압이므로 LAN 어댑터의 PHY(MAU) 회로의 플러스와 마이너스 신호 단자에서 신호가 나온다고 생각해보자. LAN 어댑터의 PHY(MAU) 회로는 오른쪽 그림과 같이 RJ-45 커넥터에 직접 결선되어 있으므로 커넥터의 1번 핀과 2번 핀에서 케이블로 신호가 흘러나간다. 그 후 신호는 케이블 속을 흘러 리피터 허브의 커넥터 부분에 도착하고, **이 부분은 단순히 전기 신호가 케이블을 통해 전달된느 것 뿐이다.**

<br>

<img src="/assets/post-img/network/lanAndRepeatHub.jpeg">

<br>

- **송출한 신호는 그대로의 모습으로 허브에 도착하는 것이 아니라 허브에 도착할 때는 신호가 약해져 있다.** 케이블의 길이가 길어질수록 신호가 약해진다. 

- 신호가 단지 약해지기만 하는 것이 아니다. 잡음이 없고 조건이 좋은 경우에도 신호가 도착할 때는 이와 같이 변형되는데, 이것에 잡음의 영향까지 더해지면 매우 심각하게 변형된다. 잡음의 영향은 강도나 종류에 따라 다르므로 한 마디로 말할 수 없다. **약해진 신호는 0과 1을 잘못 판독할 수 있는데, 이것이 통신 오류의 원인이 된다.**

<br>

> 3. '꼼'은 잡음을 방지하기 위한 방법이다

- LAN 케이블로 사용하는 **트위스트 페어 케이블**에는 이러한 잡음의 영향을 억제하는 대책이 마련되어 있는데 이것이 '꼼'이다. '트위스트 페어'라는 말은 두 가닥의 신호선을 한 조로 하여 마주 꼬았다는 데서 붙인 이름으로, 신호선을 마주 꼬아서 잡음을 막을 수 있다.
- 구체적으로 '꼼'에 의한 잡음 대책을 살펴보기 전에 잡음이 생기는 원리부터 설명한다. 잡음의 원인은 케이블의 주위에서 발생하는 전자파다. 전자파가 금속 등의 도전체에 닿으면 그 안에 전류가 발생한다는 성질이 있다. 이 때문에 케이블 주위에 전자파가 있으면 신호와는 다른 전류가 케이블 안에 흐른다. 신호도 전압에 의해 생기는 일종의 전류이므로 잡음에 의해 생기는 전류와 조금도 다르지 않다. 그 결과, **신호와 잡음의 전류가 뒤섞여서 신호의 파형이 변형되는데, 이것이 잡음의 정체다.**
- 케이블이 양향을 받는 전자파는 두 종류다
  - 모니터, 형광등, CRT 모니터와 같은 기기에서 누설되는 전자파
    - 케이블의 밖에서 오는 것으로,  선을 '꼼'으로써 막을 수 있다
    - 신호선은 금속으로 만들어져 있으므로 거기에 전자파가 닿으면 전자파의 진행 방향의 오른쪽으로 전류가 생긴다는 성질이 있다. 그런데 신호선을 마주 꼬면 형태가 나선형이 되어 꼰 옆의 선에서 전류가 흐르는 방향이 반대가 된다. 그 결과 잡음에서 생긴 전류가 서로 상쇄되어 잡음에 의한 전류는 약해진다. 당연히 신호의 전류쪽은 나선형으로 신호선이 변형되어도 변함없이 흐른다. 즉 잡음의 전류만 약해져서 영향이 줄어드는 것이다.
  - 같은 케이블 안의 인접한 신호선에서 누설되는 전자파
    - 신호선 안에는 신호라는 전류가 흐르므로 전류에 의해 주위에 전자파가 생긴다. 이것이 다른 신호선에 대한 잡음이 되는데, 이러한 잡음에 의한 영향을 **크로스토크**라고 한다.
    - 이것을 막는 대책도 신호선을 마주 꼬는 것이다. 한 개의 케이블에 넣은 신호선을 '꼬는' 간격은 모두 같은 것이 아니라 약간씩 다르다. 꼬는 간격을 미묘하게 변화시키면 어떤 부분에서는 플러스 신호가 가까이에 있고, 다른 부분에서는 마이너스 신호선이 가까워진다. 그러면 플러스와 마이너스에서는 잡음의 영향이 반대가 되므로 플러스와 마이너스의 균형이 잡히면서 잡음의 영향이 줄어드는 것이다.
  - 신호선 사이의 거리를 유지하기 위해 신호선 사이에 구분판을 넣거나  전자파를 차단하기 위해 금속성의 실드라는 피복을 입히는 등  여러가지 대책이 존재한다.

<br>

> 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다

- 신호가 리피터 허브에 도달하면 LAN 전체에 신호가 흩어진다. 전체에 패킷의 신호를 뿌리고 수신처 MAC 주소에 해당하는 기기만 패킷을 수신한다는 원리를 그대로 실현한 것이 리피터 허브이므로 이더넷의 기본에 따라 신호를 뿌리는 것이다.
- 리피터 허브의 내부에는 LAN 어댑터의 내부에 있는 PHY(MAU) 회로와 역활이 같은 회로가 있고 **클라이언트가 '송신 단자'에서 보낸 신호를 '수신 단자'로 받도록 해야한다.**
- 리피터 허브 끝의 커넥터에는 **MDI/MDI-X**와 같이 쓰여있는 전환 스위치가 붙어있다.
  - MDI
    - RJ-45 커넥터와 신호 송∙수신 회로를 직접 결선한 것
  - MDI-X
    - 교차하여 결선한 것
- 허브의 커넥터 부분은 보통 MDI-X이므로 허브끼리 접속할 때는 한쪽을 MDI로 설정해야 한다. 만약 MDI로 전환하는 스위치가 없고 모든 커넥터가 MDI-X인 경우 **크로스 케이블**로 허브들을 접속한다. 크로스 케이블은 송신과 수신 단자가 바뀌어 들어오도록 신호선을 접속한 케이블이다.

<br>

<img src="/assets/post-img/network/useCrossCable.jpeg">

<br>

-  리피터 허브에서 PHY(MAU) 회로의 수신부에 도달한 신호는 **리피터 회로**에 들어간다.
- 리피터 회로의 기본은 들어오는 신호를 리피터 허브의 커넥터 부분에 뿌리는 데 있다. 이후 신호는 모든 커넥터에서 나가면서 리피터 허브에 접속한 전체 기기에 도달한다. 그리고 신호를 수신한 기기는 맨 앞에 있는 MAC 헤더에 쓰여진 수신처 MAC 주소를 조사하여 자신이 수신처에 해당하면 이것을 수신하고, 해당하지 않으면 신호를 무시한다. 이렇게 해서 수신처 MAC 주소의 상대에게 도달한다.
- **리피터 회로의 기본은 신호를 그대로 뿌리는 것이므로 잡음의 영향을 받아 변형되고, 데이터가 변화한 것 같은 신호라도 그대로 뿌린다. 이 경우 신호가 다음 기기, 즉 스위칭 허브, 라우터, 서버 등에 도달하여 디지털 데이터로 변환되고 ,FCS를 검사하는 곳에서 데이터 변화가 판명된 후 변화된 패킷을 폐기된다.** 패킷을 폐기하면 수신확인 응답을 되돌려주지 않으므로 프로토콜 스택의 TCP 담당 부분이 패킷을 다시 보내게 된다.

<br>

<img src="/assets/post-img/network/reduceNoise.jpeg">

<br>

ref <a href="https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=163484025">성공과 실패를 결정하는 1% 네트워크 원리</a>

